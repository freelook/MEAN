<html>
<head>
<meta charset="utf-8">
<script src="./app_files/vk.js"></script>
<script type="text/javascript">
VK.init({apiId: 3520312, onlyWidgets: true});
</script>

<style>
iframe { 
position: absolute;
filter: alpha(opacity=0.0);
opacity: 0;
z-index: 1;
}

#vk {
float: right;
}

#enter {
background: #000;
width: 118px;
text-align: center;
color: #fff;
height: 24px;
padding-top: 3px;
}

</style>

</head>

<body>

<div id="vk">
<div id="enter">Вход</div>
</div>

<script type="text/javascript">
VK.Widgets.Like("vk", {type: "button", height: 24});

function getVkInfo(){
var script = document.createElement('SCRIPT');

script.src = "http://api.vk.com/method/likes.getList?type=sitepage&owner_id=3520312&page_url=" +
		location.href +
		"&extended=1&callback=callbackFunc";

document.getElementsByTagName("head")[0].appendChild(script);
}

function callbackFunc(result) {
	var data =result.response.items;
	if(data.length > 0){
	alert( 'Привет ' + data[0].first_name + ' ' + data[0].last_name + '! \n Freelook знает о тебе все :)');
	} else {
		alert('Выход');
	};
}

try {
	if (VK && VK.Observer && VK.Observer.subscribe) {
		VK.Observer.subscribe('widgets.like.liked', function() {
			getVkInfo();
		});
		VK.Observer.subscribe('widgets.like.unliked', function() {
			getVkInfo();
		});
	}
} catch (e) {
	console.error(e.message);
}
</script>
<!--
https://api.vk.com/method/likes.getList?type=sitepage&owner_id=3520312&page_url=file:///C:/Users/D.Kostrub/Desktop/test.html&extended=1
http://vk.com/js/api/openapi.js?111
http://learn.javascript.ru/clickjacking
https://vk.com/dev/Like
https://vk.com/dev/api_requests
-->
</body>
</html>
